.TH SDPARM "8" "April 2005" "sdparm-0.90" SDPARM
.SH NAME
sdparm \- fetch and potentially change SCSI disk parameters
.SH SYNOPSIS
.B sdparm
[\fI--all\fR] [\fI--clear=<str>\fR] [\fI--defaults\fR] [\fI--dummy\fR]
[\fI--enumerate\fR] [\fI--get=<str>\fR] [\fI--help\fR] [\fI--hex\fR]
[\fI--inquiry\fR] [\fI--long\fR] [\fI--page=<pg>[,<spg>]\fR]
[\fI--save\fR] [\fI--set=<str>\fR] [\fI--six\fR] [\fI--verbose\fR]
[\fI--version\fR] \fI<scsi_disk>\fR
.SH DESCRIPTION
.\" Add any additional description here
.PP
This utility primarily fetches and potentially changes SCSI disk
mode pages. Inquiry data including Vital Product Data (VPD) pages
can also be displayed.
.PP
If no options (other than <scsi_disk>) are given then a selection of
common mode page parameters for that device are listed. If the '--long'
option is also given then the description of the parameters is placed
on the right of each line. If the '--all' option is given then all
known mode page parameters for that device are listed.
.PP
Although this utility is primarily designed for SCSI disks (or storage
devices that appear to the OS as SCSI disks) many of the mode pages
are in common with other SCSI devices. These include CD/DVD players
that use the ATAPI transport, SCSI tapes drives and SCSI enclosures.
.TP
--all | -a
by default when mode pages are being displayed only a small number of
parameters are shown. When this option is given, all recognised parameters
are output. The default action is to output a relatively small number
of parameters from different pages. When a specific (mode) page number
is given with the "--page=" option the all the parameters of that
page are output (irrespective of the setting of this option).
.TP
--clear=<str> | -c <str>
The <str> contains a comma separated list of parameter acronyms whose
values are to be set to zero. See the parameters section below.
.TP
--defaults | -D
sets the given mode page (via '--page=' option) to its default values.
To make the default mode page values also the saved mode page values
use the '--save' option as well.
.TP
--dummy | -d
when set inhibits changes being written back to a mode page. Instead
the mode data that would have been sent to a MODE SELECT command,
is output in ASCII hex to the console.
.TP
--enumerate | -e
lists out the mode pages and parameters known by this utility. Ignores
the <scsi_device> argument and most other options apart from the '--page='
and '-all' options. If '--enumerate' is given without other options
then the known mode pages are listed. If it is given with a page
number then all known parameters (fields) in that mode page are
listed. If '--enumerate' is given with the '-all' option then all
mode pages followed by all parameters within those mode pages are
listed. See listings section below.
.TP
--get=<str> | -g <str>
The <str> contains a comma separated list of parameter acronyms whose
values are to be fetched to zero. See the parameters section below.
The '--long' and '--hex' options effect the output format. Also if
a value of "1" is given (e.g. '--get=WCE=1') only the current value
is output.
.TP
--help | -h
output the usage message then exit.
.TP
--hex | -H
rather than trying to decode mode (or VPD) pages, print them out in
hex. When used with the '-get=' option the corresponding current,
changeable, default and saveable values are output in hex, prefixed
by "0x" and space separated. If a value of "1" is given with
the '--get=' option (e.g. '--get=WCE=1') then only the current value
is output in hex, prefixed by "0x".
.TP
--inquiry | -i
output INQUIRY VPD pages. The default is to output mode pages.
.TP
--long | -l
output extra information. In the case of mode page parameters a
description (with units if applicable) is output to the right if
it is known.
.TP
--page=<pg>[,<spg>] | -p <pg>[,<spg>]
supply the page number and optionally the sub page number of the mode
page to output. These numbers re interpreted as decimal unless
prefixed with "0x". Alternatively a two letter abbreviation for
a (mode) page can be given (e.g. "--page=ca" for the caching control
mode page). See the '--enumerate' option for available abbreviations.
.TP
--page=<str> | -p <str>
alternatively a two letter acronym for a mode page can be given.
The '--enumerate' option can be used to list the mode page
acronyms.
.TP
--save | -S
when a mode page is being modified (by using the '--clear=' and/or '--set="
options) then the default action is to only modify the current mode page.
When this option is given the corresponding value(s) in the saved mode
page is also changed. The next time the device is power cycled (or reset)
the saved mode page values become (i.e. are copied to) the current mode
page. See notes section below.
.TP
--set=<str> | -s <str>
The <str> contains a comma separated list of parameter acronyms whose
values are to be set to (all) ones. Alternatively each acronym may be
followed by "=<n>" where <n> is the value to set that parameter to.
See the parameters section below.
.TP
--six | -6
The default action of this utility is to issue MODE SENSE and MODE
SELECT SCSI commands with 10 byte cdbs. When this option is given the
6 byte cdb variants are used.
.TP
--verbose | -v
increase the level of verbosity, (i.e. debug output).
.TP
--version | -V
print the version string and then exit.
.SH PARAMETERS
The '--clear=', '--get=' and '--set=" options can take a string argument
which is a comma separated list of parameters. Each parameter can
be either an acronym name or a <start_byte>:<start_bit>:<num_bits> triple
Either form can optionally be followed by "=<val>". Acronyms (e.g.
WCE for "write cache enable") that this utility supports can be viewed
with the '--enumerate' option.  Alternatively the mode page parameters
to be changed can be described in terms of a <start_byte> (origin 0)
within the mode page, a <start_bit> (0 to 7 inclusive) and <num_bits> (1
to 32 inclusive). The low level representation of the WCE bit (in
the caching control mode page) is 2:2:1 . The <start_byte> and 
the <val>  can optionally be given in hex (prefixed with "0x").
.PP
Both '--clear=' and '--set=" parameter lists can be given. The only
difference is the value set in the absence of "=<val>". For '--clear='
the default value is zero while for '--set' the default value is all
ones (as many as <num_bits> permits).
.PP
When an acronym is given the mode page is imputed from that acronym (e.g.
WCE is in the cache mode page). When only the start_byte:start_bit:num_bits
representation is used then the '--page=' option must be given to establish
which mode page is to be used. When multiple parameters are given, they
must all be in the same mode page (except for '--get=').
.SH LISTINGS
When known mode pages are listed (via the '--enumerate' option) each
line starts with a two letter acronym. This is followed by the page
number (in hex prefixed by "0x") optionally followed by a comma and
the subpage number. Finally the descriptive name of the mode
page (i.e. as found in spc-3 or sbc-2) is output.
.PP
When known parameters (fields) of a mode page are listed each line
starts with an acronym. This will match (or be an acronym for) the
description for that field found in the draft standards. Next are
three numbers, separated by colons, surrounded by brackets. These
are the byte offset (in hex, prefixed by "0x") of the start of the
field within the mode page; the starting bit (0 through 7 inclusive)
and then the number of bits. The descriptive name of the
parameter (field) is then given, with units where 
applicable (e.g. "(ms)" means the units are milliseconds).
.PP
Mode parameters for which the num_bits is greater than 1 can be
viewed as unsigned integers. Often 16 and 32 bit fields are set
to 0xffff and 0xffffffff respectively (all ones) which usually
has a special meaning (see drafts). In listings such values are
represented by "-1" to save space (rather than their unsigned
integer equivalents).
.SH NOTES
The SPC-3 draft (rev 22a) says that devices that implement no
distinction between current and saved pages can return an
error (ILLEGAL REQUEST, invalid field in cdb) if the SP bit (which
corresponds to the '--save' option) is _not_ set. In such cases
the '--save' option needs to be given.
.PP
If the '--save' option is given but the existing mode page indicates (via
its PS bit) that the page is not savable, then this utility generates
an error message. That message suggests to try again without the '--save'
option. 
.PP
In the 2.4 series of Linux kernels the given device must be
a SCSI generic (sg) device. In the 2.6 series block devices (e.g. disks
and SCSI DVDs) can also be specified. For example "sdparm /dev/sda"
will work in the 2.6 series kernels. From lk 2.6.6 other SCSI "char"
device names may be used as well (e.g. "/dev/st0m").
.SH EXAMPLES
These examples assume a 2.6 series linux kernel. For the 2.4 series
scsi generic (i.e. sg) device names would need to be used.
To list the common (mode) parameters of a disk:
.PP
   sdparm /dev/sda
.PP
To see all parameters for the caching control mode page:
.PP
   sdparm --page=ca /dev/sda
.PP
To get the WCE values (current changeable default and saved) in hex:
.PP
   sdparm -g WCE -H /dev/sda
.br
0x01 0x00 0x01 0x01
.PP
To get the WCE current value in hex:
.PP
   sdparm -g WCE=1 -H /dev/sda
.br
0x01
.PP
To set the "write cache enable" bit in the current page:
.PP
   sdparm --set=WCE /dev/sda
.PP
To set the "write cache enable" bit in the current and saved page:
.PP
   sdparm --set=WCE --save /dev/sda
.PP
To set the "write cache enable" and clear "read cache disable":
.PP
   sdparm --set=WCE --clear=RCD --save /dev/sda
.PP
The previous example can also by written as:
.PP
   sdparm -s WCE=1,RCD=0 -S /dev/sda
.PP
To re-establish the manufacturer's defaults in the current and saved
caching control mode page:
.PP
   sdparm --page=ca --defaults -save /dev/sda
.PP
If an ATAPI cd/dvd player is at /dev/hdc then its common (mode) parameters
could be listed with:
.PP
   sdparm /dev/hdc
.PP
One disk vendor has a "performance mode" bit (PM) in the vendor specific
unit attention mode page [0x0,0x0]. PM=0 is server mode (the default)
while PM=1 is desktop mode. Desktop mode can be set (both current and
saved) with: 
.PP
   sdparm --page=0 --set=2:7:1=1 --save /dev/sda
.PP
The resultant change can be viewed in hex with the '--hex' option as
there are no acronyms for vendor extensions yet.
.SH AUTHORS
Written by Douglas Gilbert.
.SH "REPORTING BUGS"
Report bugs to <dgilbert at interlog dot com>.
.SH COPYRIGHT
Copyright \(co 2005 Douglas Gilbert
.br
This software is distributed under a FreeBSD license. There is NO
warranty; not even for MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.
.SH "SEE ALSO"
.B sg_modes(sg3_utils), sg_wr_mode(sg3_utils), sginfo(sg3_utils)
.B sg_senddiag(sg3_utils), smartmontools(internet, sourceforge)
