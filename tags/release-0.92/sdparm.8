.TH SDPARM "8" "May 2005" "sdparm-0.92" SDPARM
.SH NAME
sdparm \- fetch and potentially change SCSI disk parameters
.SH SYNOPSIS
.B sdparm
[\fI--all\fR] [\fI--clear=<str>\fR] [\fI--defaults\fR] [\fI--dummy\fR]
[\fI--flexible\fR] [\fI--get=<str>\fR] [\fI--help\fR] [\fI--hex\fR]
[\fI--inquiry\fR] [\fI--long\fR] [\fI--page=<pg>[,<spg>]\fR]
[\fI--save\fR] [\fI--set=<str>\fR] [\fI--six\fR] [\fI--verbose\fR]
[\fI--version\fR] \fI<scsi_disk>\fR
.PP
.B sdparm
[\fI--all\fR] \fI--enumerate\fR [\fI--inquiry\fR] [\fI--page=<pg>[,<spg>]\fR]
.SH DESCRIPTION
.\" Add any additional description here
.PP
This utility primarily fetches and potentially changes SCSI disk
mode pages. Inquiry data including Vital Product Data (VPD) pages
can also be displayed.
.PP
If no options (other than <scsi_disk>) are given then a selection of
common mode page parameters for that device are listed. If the '--long'
option is also given then the description of the parameters is placed
on the right of each line. If the '--all' option is given then all
known mode page parameters for that device are listed.
.PP
Although this utility is primarily designed for SCSI disks (or storage
devices that appear to the OS as SCSI disks) many of the mode pages
are in common with other SCSI devices. These include CD/DVD players
that use the ATAPI transport, SCSI tapes drives and SCSI enclosures.
.PP
When the '--inquiry' option is given and there is no page number then
the Device Identification VPD page (page number 0x83) is requested and
if found it is decoded and output. If no page number is given and
the '--all' option is given then all VPD page names (but not their
contents) supported by the given device are listed.
.TP
--all | -a
output all recognised parameters for the device type (e.g. disk)
of the given device. The default action is to output a
relatively small number of parameters from different pages. When a
specific (mode) page number is given with the '--page=' option then
all the parameters of that page are output (irrespective of the
setting of this option). May also be used with the '--enumerate'
option.
.TP
--clear=<str> | -c <str>
The <str> contains a comma separated list of parameter acronyms. In
the absence of an explicit value, each acronym has its value set to
zero. Utility exits with process status 0 if successful, else 1.
See the parameters section below.
.TP
--defaults | -D
sets the given mode page to its default values. Requires the '--page='
option to be given to specify the mode page. To make the default mode
page values also the saved mode page values use the '--save' option as
well.
.TP
--dummy | -d
when set inhibits changes being placed in the device's mode page.
Instead the mode data that would have been sent to a MODE SELECT
command, is output in ASCII hex to the console.
.TP
--enumerate | -e
lists out the pages and parameters known by this utility. Ignores
the <scsi_device> argument and most other options apart from 
the '--page=', '--inquiry' and '-all' options. If '--enumerate' is
given without other options then the known mode pages are listed.
If it is given with a page number then all known parameters (fields) in
that mode page are listed. If '--enumerate' is given with the '-all'
option then all mode pages followed by all parameters within those mode
pages are listed. If '--enumerate' is given with the '--inquiry' option
then known VPD pages are listed. See listings section below.
.TP
--flexible | -f
Some devices, bridges and/or drivers attempt crude switches between
mode sense 6 and 10 byte commands without correcting the response.
This will cause the response to be mis-interpreted (usually with an
error saying the response is malformed). With this option, the length
of the response is checked, and if it looks wrong, various corrections
are attempted. This option will also allow mode pages that don't belong
to the current device's peripheral type to be listed.
.TP
--get=<str> | -g <str>
The <str> contains a comma separated list of parameter acronyms whose
values are to be fetched. See the parameters section below. The '--long'
and '--hex' options effect the output format. Also if a value of "1" is
given (e.g. '--get=WCE=1') only the current value is output.
.TP
--help | -h
output the usage message then exit.
.TP
--hex | -H
rather than trying to decode mode (or VPD) pages, print them out in
hex. When used with the '-get=' option the corresponding current,
changeable, default and saveable values are output in hex, prefixed
by "0x" and space separated. If a value of "1" is given with
the '--get=' option (e.g. '--get=WCE=1') then only the current value
is output in hex, prefixed by "0x".
.TP
--inquiry | -i
output INQUIRY VPD pages. In the absence of this option the default action
is to output mode pages. If the '--inquiry' option is given without
the '--page=' option then the device identification VPD page is decoded
and output.
.TP
--long | -l
output extra information. In the case of mode page parameters a
description (with units if applicable) is output to the right.
If used twice, more information from the given device's standard
INQUIRY response is decoded.
.TP
--page=<pg>[,<spg>] | -p <pg>[,<spg>]
supply the page number and optionally the sub page number of the
mode (or VPD) page to output. These numbers are interpreted as decimal
unless prefixed with "0x". Sub page numbers are only valid for mode
pages (not VPD pages). Alternatively a two letter abbreviation for
a page can be given (see next entry).
.TP
--page=<str> | -p <str>
a two or three letter abbreviation for a page can be given. Known mode
page abbreviations are checked first followed by known VPD page
abbreviations.
For example '--page=ca' matches the caching control mode page.
If no match is found then an error is issued. If the <str> matches a
known VPD page abbreviation then the '--inquiry' option is turned
on (internally). The '--enumerate' option can be used to list
the mode page abbreviations. When both the '--enumerate' and '--inquiry'
options are given then a list of VPD page abbreviations is produced.
.TP
--save | -S
when a mode page is being modified (by using the '--clear=' and/or '--set="
options) then the default action is to only modify the current values
mode page. When this option is given then the corresponding value(s) in
the saved values mode page is also changed. The next time the device is
power cycled (or reset) the saved values mode page becomes (i.e. is
copied to) the current values mode page. See notes section below.
.TP
--set=<str> | -s <str>
The <str> contains a comma separated list of parameter acronyms. In
the absence of an explicit value, each acronym has its value set
to (all) ones. This means a 16 bit field will be set to 0xffff which
is 65535 in decimal. Alternatively each acronym may be followed by "=<n>"
where <n> is the value to set that parameter to. Utility exits with
process status 0 if successful, else 1. See the parameters section below.
.TP
--six | -6
The default action of this utility is to issue MODE SENSE and MODE
SELECT SCSI commands with 10 byte cdbs. When this option is given the
6 byte cdb variants are used. Only old SCSI devices should need this
option. This utility outputs a suggestion to use this option if
the SCSI status indicates that the 10 byte cdb variant is not
supported.
.TP
--verbose | -v
increase the level of verbosity, (i.e. debug output).
.TP
--version | -V
print the version string and then exit.
.PP
A mode page for which no acronym is known (e.g. a vendor specific mode
page) can be listed in hexadecimal by using the option
combination "--page=<pn> --hex". The same applies for a mode page field
for which no acronym is known.
.SH PARAMETERS
The '--clear=', '--get=' and '--set=" options can take a string argument
which is a comma separated list of parameters. Each parameter can
be either an acronym name or a <start_byte>:<start_bit>:<num_bits> tuple.
Either form can optionally be followed by "=<val>". Acronyms (e.g.
WCE for "write cache enable") that this utility supports can be listed
with the '--enumerate' option.  Alternatively the mode page parameters
to be changed can be described in terms of a <start_byte> (origin 0)
within the mode page, a <start_bit> (0 to 7 inclusive) and <num_bits> (1
to 32 inclusive). For example, the low level representation of the RCD
bit (in the caching control mode page) is 2:0:1 . The <start_byte> and 
the <val> can optionally be given in hex (prefixed with "0x").
.PP
Both '--clear=' and '--set=" parameter lists can be given. The only
difference is the value set in the absence of "=<val>". For '--clear='
the default value is zero while for '--set' the default value is all
ones (as many as <num_bits> permits).
.PP
When an acronym is given the mode page is imputed from that acronym (e.g.
WCE is in the cache mode page). When only the start_byte:start_bit:num_bits
representation is used then the '--page=' option must be given to establish
which mode page is to be used. When multiple parameters are given, they
must all be in the same mode page (except for '--get=').
.SH LISTINGS
When known mode pages are listed (via the '--enumerate' option) each
line starts with a two letter acronym. This is followed by the page
number (in hex prefixed by "0x") optionally followed by a comma and
the subpage number. Finally the descriptive name of the mode
page (i.e. as found in SPC-3 or SBC-2) is output.
.PP
When known parameters (fields) of a mode page are listed each line
starts with an acronym. This will match (or be an acronym for) the
description for that field found in the draft standards. Next are
three numbers, separated by colons, surrounded by brackets. These
are the byte offset (in hex, prefixed by "0x") of the start of the
field within the mode page; the starting bit (0 through 7 inclusive)
and then the number of bits. The descriptive name of the
parameter (field) is then given, with units where 
applicable (e.g. "(ms)" means the units are milliseconds).
.PP
Mode parameters for which the num_bits is greater than 1 can be
viewed as unsigned integers. Often 16 and 32 bit fields are set
to 0xffff and 0xffffffff respectively (all ones) which usually
has a special meaning (see drafts). In listings such values are
represented by "-1" to save space (rather than their unsigned
integer equivalents). "-1" can also be given as the value to
a mode page field acronym.
.SH NOTES
The SPC-3 draft (rev 23) says that devices that implement no
distinction between current and saved pages can return an
error (ILLEGAL REQUEST, invalid field in cdb) if the SP bit (which
corresponds to the '--save' option) is _not_ set. In such cases
the '--save' option needs to be given.
.PP
If the '--save' option is given but the existing mode page indicates (via
its PS bit) that the page is not savable, then this utility generates
an error message. That message suggests to try again without the '--save'
option. 
.PP
In the linux kernel 2.6 series any device node that understands a SCSI
command set (e.g. SCSI disks and CD/DVD drives) may be specified. More
precisely the driver that "owns" the device node must support the SG_IO
ioctl. In the lk 2.4 series only SCSI generic (sg) device nodes support
the SG_IO ioctl. However in the lk 2.4 series other SCSI device nodes are
mapped within this utility to their corresponding sg device nodes. So if
there is a SCSI disk at /dev/sda then "sdparm /dev/sda" will work in both
the lk 2.6 and lk 2.4 series. However if there is an ATAPI disk at /dev/hdc
then "sdparm /dev/hdc" will only work in the lk 2.6 series.
.SH EXAMPLES
To list the common (mode) parameters of a disk:
.PP
   sdparm /dev/sda
.PP
To list the descriptors within the device identification VPD page
of a disk:
.PP
   sdparm --inquiry /dev/sda
.PP
To see all parameters for the caching control mode page:
.PP
   sdparm --page=ca /dev/sda
.PP
To get the WCE values (current changeable default and saved) in hex:
.PP
   sdparm -g WCE -H /dev/sda
.br
0x01 0x00 0x01 0x01
.PP
To get the WCE current value in hex:
.PP
   sdparm -g WCE=1 -H /dev/sda
.br
0x01
.PP
To set the "write cache enable" bit in the current values page:
.PP
   sdparm --set=WCE /dev/sda
.PP
To set the "write cache enable" bit in the current and saved values page:
.PP
   sdparm --set=WCE --save /dev/sda
.PP
To set the "write cache enable" and clear "read cache disable":
.PP
   sdparm --set=WCE --clear=RCD --save /dev/sda
.PP
The previous example can also by written as:
.PP
   sdparm -s WCE=1,RCD=0 -S /dev/sda
.PP
To re-establish the manufacturer's defaults in the current and saved
values caching control mode page:
.PP
   sdparm --page=ca --defaults --save /dev/sda
.PP
If an ATAPI cd/dvd player is at /dev/hdc then its common (mode) parameters
could be listed in the lk 2.6 series with:
.PP
   sdparm /dev/hdc
.PP
One disk vendor has a "performance mode" bit (PM) in the vendor specific
unit attention mode page [0x0,0x0]. PM=0 is server mode (the default)
while PM=1 is desktop mode. Desktop mode can be set (both current and
saved values) with: 
.PP
   sdparm --page=0 --set=2:7:1=1 --save /dev/sda
.PP
The resultant change can be viewed in hex with the '--hex' option as
there are no acronyms for vendor extensions yet.
.SH AUTHORS
Written by Douglas Gilbert.
.SH "REPORTING BUGS"
Report bugs to <dgilbert at interlog dot com>.
.SH COPYRIGHT
Copyright \(co 2005 Douglas Gilbert
.br
This software is distributed under a FreeBSD license. There is NO
warranty; not even for MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.
.SH "SEE ALSO"
.B sg_modes(sg3_utils), sg_wr_mode(sg3_utils), sginfo(sg3_utils),
.B sg_senddiag(sg3_utils), sg_inq(sg3_utils),
.B smartmontools(internet, sourceforge)
